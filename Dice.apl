:NameSpace Dice

_U_ ← {⍺←⊢ ⋄ ⍵⍵⍣¯1⊢⍺ ⍺⍺⍥⍵⍵ ⍵}
_O_ ← {⍺←⍵ ⋄ (⍺⍺ ⍺)⍵⍵ ⍵}

_I ← { 
    loc ← ⍵∊⊂⍺
    ri  ← 1@(≢↑((-,+)∘1)_U_⍸)loc
    ri≡0:⍵
    ⊃,/⍺⍺¨@{∧/¨P⍨ri} ⍵ P ri
}

⍝ Doesn't handle parentheses
Parse  ← {
    P  ← ⊣⊂⍨1,2≠/⊢
    r  ← (⍵~' ') (⊣P∊) '0123456789'
    
    r {⊆∊ '(+/?' (⊣/⍵) '⍴' (⊢/⍵) ')' }_I⍨∘, 'O'
}

⍝ '1O20 + 1'
┌─────────┬─┬─┐
│(+/?1⍴20)│+│1│
└─────────┴─┴─┘

:EndNameSpace
